services:
  # 1. The Brain (Python LangGraph Agent)
  agent-backend:
    build: .
    ports:
      - "8000:8000"
    environment:
      # OpenAI & LangChain
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - LANGCHAIN_TRACING_V2=true
      - LANGCHAIN_API_KEY=${LANGCHAIN_API_KEY}
      - LANGCHAIN_PROJECT=${LANGCHAIN_PROJECT}
      # MCP Server (Tools Service)
      - MCP_SERVER_URL=http://tools-service:3001
      # Victoria Metrics & Logs
      - VICTORIA_METRICS_URL=${VICTORIA_METRICS_SELECT_URL}
      - VICTORIA_LOGS_API_URL=${VICTORIA_LOGS_API_URL}
      # Manifest API
      - MANIFEST_API_URL=${MANIFEST_API_URL}
      - MANIFEST_API_KEY=${MANIFEST_API_KEY}
    depends_on:
      - tools-service
    volumes:
      - ./app:/app/app # Live reload for development

  # 2. The Limbs (Node.js Tools Service)
  tools-service:
    build: ./tools-service
    ports:
      - "3001:3001"
    environment:
      - SERVER_PORT=3001
      # Manifest API
      - MANIFEST_API_KEY=${MANIFEST_API_KEY}
      - MANIFEST_ORG_KEY=${MANIFEST_ORG_KEY}
      - MANIFEST_ORG_ID=${MANIFEST_ORG_ID}
      - MANIFEST_API_URL=${MANIFEST_API_URL}
      # Victoria Metrics & Logs
      - VICTORIA_METRICS_SELECT_URL=${VICTORIA_METRICS_SELECT_URL}
      - VICTORIA_LOGS_URL=${VICTORIA_LOGS_API_URL}
